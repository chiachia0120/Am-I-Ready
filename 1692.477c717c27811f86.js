"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1692],{1692:(z,x,a)=>{a.r(x),a.d(x,{PlanPage:()=>S});var u=a(467),y=a(2200),C=a(4341),n=a(9893),k=a(6354),_=a(6697);function M(l){return{0:"Clear sky",1:"Mainly clear",2:"Partly cloudy",3:"Overcast",45:"Fog",48:"Depositing rime fog",51:"Light drizzle",53:"Moderate drizzle",55:"Dense drizzle",56:"Light freezing drizzle",57:"Dense freezing drizzle",61:"Slight rain",63:"Moderate rain",65:"Heavy rain",66:"Light freezing rain",67:"Heavy freezing rain",71:"Light snowfall",73:"Moderate snowfall",75:"Heavy snowfall",77:"Snow grains",80:"Slight rain showers",81:"Moderate rain showers",82:"Violent rain showers",85:"Slight snow showers",86:"Heavy snow showers",95:"Thunderstorm (slight or moderate)",96:"Thunderstorm with light hail",99:"Thunderstorm with heavy hail"}[l]??"Unknown weather condition"}var e=a(3664),d=a(2615),f=a(6919),w=a(943);function O(l,P){if(1&l){const t=e.RV6();e.j41(0,"ion-item")(1,"ion-checkbox",9),e.bIt("ionChange",function(){const r=d.eBV(t).$implicit,c=e.XpG();return d.Njj(c.toggleActivity(r))}),e.k0s(),e.j41(2,"ion-label"),e.EFF(3),e.k0s(),e.j41(4,"ion-button",10),e.bIt("click",function(){const r=d.eBV(t).$implicit,c=e.XpG();return d.Njj(c.removeActivity(r))}),e.nrm(5,"ion-icon",11),e.k0s()()}if(2&l){const t=P.$implicit;e.R7$(),e.Y8G("checked",t.selected),e.R7$(2),e.JRh(t.title)}}let S=(()=>{class l{constructor(t,i,r,c,g,p,m){this.loadingCtrl=t,this.planService=i,this.toast=r,this.router=c,this.weatherService=g,this.geminiService=p,this.prefService=m,this.newTitle="",this.state$=this.planService.state$}get preferences(){return this.prefService.getPreferences()}ngOnInit(){this.activities$=this.planService.plans$,this.selectedCount$=this.activities$.pipe((0,k.T)(t=>(t??[]).filter(i=>i.selected).length)),this.weatherService.initLocation()}addActivity(t){const i=(t??"").toString().trim();i&&this.planService.addActivity(i)}toggleActivity(t){this.planService.toggleActivity(t.id)}removeActivity(t){var i=this;return(0,u.A)(function*(){const r=t.id;i.planService.removeActivity(t.id),yield(yield i.toast.create({message:`${t.title} removed`,buttons:[{text:"Undo",handler:()=>{i.planService.restoreActivity(r)}}],duration:3e3})).present()})()}generateChecklist(){var t=this;this.activities$.pipe((0,_.s)(1)).subscribe(function(){var i=(0,u.A)(function*(r){const c=r.filter(s=>s.selected);if(0===c.length)return void t.toast.create({message:"No plan selected!",duration:1e3}).then(s=>s.present());const g=yield t.loadingCtrl.create({message:"Generating checklist...",spinner:"circles"});yield g.present();const p=t.preferences;let m=null;var s;p&&(m=Object.entries(p).reduce((s,[o,h])=>(2!==h&&(s[o]=0===h?"Yes":"No"),s),{})),t.weatherService.getWeather().subscribe({next:(s=(0,u.A)(function*(o){const h={temperature_now:o.current_weather.temperature,temperature_max:o.daily.temperature_2m_max[0],temperature_min:o.daily.temperature_2m_min[0],description:M(o.current_weather.weathercode),weatherCode:o.current_weather.weathercode,windspeed:o.current_weather.windspeed,is_day:o.current_weather.is_day};t.planService.setWeather(h);const j={plans:c.map(v=>v.title),weather:h,preferences:m};try{const v=yield t.geminiService.generateChecklist(j);t.planService.setChecklist(v),t.toast.create({message:"Checklist generated!",duration:1e3}).then(b=>b.present()),t.router.navigateByUrl("/pages/checklist")}catch{t.toast.create({message:"Failed to generate checklist",duration:1500}).then(b=>b.present())}finally{g.dismiss()}}),function(h){return s.apply(this,arguments)}),error:function(){var s=(0,u.A)(function*(){g.dismiss(),t.toast.create({message:"Failed to fetch weather",duration:1500}).then(o=>o.present())});return function(){return s.apply(this,arguments)}}()})});return function(r){return i.apply(this,arguments)}}())}static#e=this.\u0275fac=function(i){return new(i||l)(e.rXU(n.Xi),e.rXU(f.J8),e.rXU(n.K_),e.rXU(w.Ix),e.rXU(f.Wd),e.rXU(f.pG),e.rXU(f.HK))};static#t=this.\u0275cmp=e.VBU({type:l,selectors:[["app-plan"]],decls:25,vars:9,consts:[["newActivity",""],[1,"plan-title"],["name","calendar-outline"],[1,"text"],[4,"ngFor","ngForOf"],["type","text","placeholder","Add a plan"],["fill","clear","slot","end",3,"click"],["name","add-outline"],["expand","block",1,"generate-btn",3,"click"],["slot","start",3,"ionChange","checked"],["fill","clear","color","danger","slot","end",3,"click"],["name","trash-outline"]],template:function(i,r){if(1&i){const c=e.RV6();e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"What's your plan today?"),e.k0s()()(),e.j41(4,"ion-content")(5,"ion-card")(6,"ion-card-header")(7,"ion-card-title",1),e.nrm(8,"ion-icon",2),e.j41(9,"div",3),e.EFF(10),e.nI1(11,"async"),e.nI1(12,"async"),e.k0s()()(),e.j41(13,"ion-list"),e.DNE(14,O,6,2,"ion-item",4),e.nI1(15,"async"),e.j41(16,"ion-item"),e.nrm(17,"ion-input",5,0),e.j41(19,"ion-button",6),e.bIt("click",function(){d.eBV(c);const p=e.sdS(18);return r.addActivity(p.value),d.Njj(p.value="")}),e.nrm(20,"ion-icon",7),e.k0s()()()()(),e.j41(21,"ion-footer")(22,"ion-toolbar")(23,"ion-button",8),e.bIt("click",function(){return d.eBV(c),d.Njj(r.generateChecklist())}),e.EFF(24," Generate Checklist "),e.k0s()()()}2&i&&(e.R7$(10),e.Lme(" ",e.bMT(11,3,r.selectedCount$)," Plan",(e.bMT(12,5,r.selectedCount$)??0)>1?"s":""," for today "),e.R7$(4),e.Y8G("ngForOf",e.bMT(15,7,r.activities$)))},dependencies:[y.MD,y.Sq,C.YN,n.bv,n.Jm,n.b_,n.ME,n.tN,n.eY,n.W9,n.M0,n.eU,n.iq,n.$w,n.uz,n.he,n.nf,n.BC,n.ai,n.hB,n.Gw,y.Jj],styles:["ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: #efe3c7;--color: #000;--border-color: #efe3c7}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{padding-top:12px;font-size:clamp(16px,4vw,20px)}ion-card[_ngcontent-%COMP%]{border-radius:12px;box-shadow:0 4px 8px #00000080;margin:12px;overflow:hidden}ion-card-header[_ngcontent-%COMP%]{display:flex;justify-content:center;background:#a2bde0;padding:8px 12px}ion-card-header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-weight:600}ion-card-content[_ngcontent-%COMP%]{padding-inline-start:0;padding-inline-end:0;padding-top:0;padding-bottom:0}.plan-title[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:6px;background:#a2bde0;color:#fff;padding:4px 8px;font-size:18px}.plan-title[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-weight:600}ion-list[_ngcontent-%COMP%]{padding:0;margin:0 12px;background:transparent}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{list-style:none;margin-bottom:12px;border-radius:8px;background:#fff;box-shadow:0 2px 6px #00000014;--padding-start: 16px;--inner-padding-end: 12px;--min-height: 60px}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:last-child{margin-bottom:0}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-checkbox[_ngcontent-%COMP%]{--size: 22px;--checkmark-color: #000;--border-color: #aaa;--border-color-checked: #f9c74f;--checkbox-background: #fff;--checkbox-background-checked: #f9c74f;padding-right:8px}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:16px;font-weight:500;color:#222}.generate-btn[_ngcontent-%COMP%]{--color: #333333;--padding-top: 12px;--padding-bottom: 12px;--ripple-color: transparent;--background-activated: transparent;--background-focused: transparent;--border-color: #333333;--border-style: solid;--border-width: 1px;font-weight:600;font-size:18px}.generate-btn[_ngcontent-%COMP%]:active{--background: #d3d4d5}"]})}return l})()}}]);