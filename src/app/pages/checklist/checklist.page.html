<ion-header>
  <ion-toolbar>
    <ion-title>Checklist</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [scrollEvents]="true" (ionScroll)="onScroll()">
  <!-- Weather Card -->
  <ng-container *ngIf="weather$ | async as weather">
    <ion-card>
      <ion-card-content>
        <div class="weather-card">
          <!-- left：location + weather info -->
          <div class="weather-left">
            <div class="city">{{ cityName }}</div>
            <div class="description">{{ weather.description }}</div>
            <div class="temp">{{ weather.temperature_now }}°</div>
          </div>

          <!-- right：icon -->
          <img
            class="weather-icon"
            [src]="mapWeatherIcon(weather.weatherCode)"
            alt="weather icon"
          />
        </div>

        <!-- weather footer -->
        <div class="weather-footer">
          <div>
            <div class="label">Highest</div>
            <div class="value">{{ weather.temperature_max }}°</div>
          </div>
          <div>
            <div class="label">Lowest</div>
            <div class="value">{{ weather.temperature_min }}°</div>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Sticky Mini Weather -->
    <div class="sticky-header" [class.hide]="!showMiniWeather">
      <div class="mini-weather">
        <img
          class="weather-icon"
          [src]="mapWeatherIcon(weather.weatherCode)"
          alt="weather icon"
        />

        <div class="text">
          {{ weather.temperature_now }}° {{ weather.description }}
        </div>

        <div class="spacer"></div>
        <!-- 空白佔位 -->

        <img
          class="weather-icon"
          [src]="mapWeatherIcon(weather.weatherCode)"
          alt="weather icon"
        />

        <div class="progress-container">
          <ion-progress-bar [value]="progress$ | async"></ion-progress-bar>
          <p class="progress-label">
            {{ (((progress$ | async) ?? 0) * 100) | number:'1.0-0' }}%
          </p>
        </div>
      </div>

      <!-- <ng-container *ngTemplateOutlet="progressBar"></ng-container> -->
    </div>
  </ng-container>

  <!-- Checklist Title -->
  <ion-text class="checklist-title">
    <div>Checklist</div>
  </ion-text>

  <!-- Progress bar -->
  <div class="progress-container">
    <ion-progress-bar [value]="progress$ | async"></ion-progress-bar>
    <p class="progress-label">
      {{ (((progress$ | async) ?? 0) * 100) | number:'1.0-0' }}%
    </p>
  </div>
  <!-- <ng-container *ngTemplateOutlet="progressBar"></ng-container> -->

  <!-- Checklist Items -->
  <ion-list>
    <ion-item *ngFor="let item of (checklist$ | async)">
      <ion-icon
        [name]="item.icon || 'briefcase-outline'"
        slot="start"
      ></ion-icon>
      <ion-label>{{ item.label }}</ion-label>
      <ion-checkbox
        slot="end"
        [checked]="item.selected"
        (ionChange)="toggleChecklistItem(item)"
      ></ion-checkbox>
    </ion-item>
  </ion-list>

  <!-- Sorted Popup -->
  <div class="sorted-popup" *ngIf="showSorted">
    <div class="sorted-circle">
      <h2>You’re sorted!</h2>
      <p>Let’s go 🎉</p>
    </div>
  </div>
</ion-content>

<ng-template #progressBar>
  <div class="progress-container">
    <ion-progress-bar [value]="progress$ | async"></ion-progress-bar>
    <p class="progress-label">
      {{ (((progress$ | async) ?? 0) * 100) | number:'1.0-0' }}%
    </p>
  </div>
</ng-template>
